<!DOCTYPE html>
<html>
<head>
    <title>Peta Web Sleman</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
        }

        /* Peta full screen */
        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            right: 0;
            left: 0;
            z-index: 1;
        }

        /* Legend mengambang di atas peta */
        #bigLegend {
            position: absolute;
            top: 10px;
            left: 10px;
            background: white;
            padding: 10px;
            border-radius: 8px;
            line-height: 18px;
            color: #333;
            box-shadow: 0 0 8px rgba(0,0,0,0.3);
            z-index: 9999;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>

<div id="map"></div>

<!-- Legend -->
<div id="bigLegend">
    <h4>Legenda</h4>
    <strong>Administrasi Desa</strong><br>
    <img src="http://localhost:8080/geoserver/wms?REQUEST=GetLegendGraphic&VERSION=1.0.0&FORMAT=image/png&LAYER=pgwebAcara10:ADMINISTRASIDESA_AR_25K">
</div>

<script>
    var map = L.map('map').setView([-7.677567, 110.406893], 12);

    var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19
    }).addTo(map);

    var polygonLayer = L.tileLayer.wms("http://localhost:8080/geoserver/pgwebAcara10/wms", {
        layers: "pgwebAcara10:ADMINISTRASIDESA_AR_25K",
        format: "image/png",
        transparent: true
    }).addTo(map);

    var jalanLayer = L.tileLayer.wms("http://localhost:8080/geoserver/pgwebAcara10/wms", {
        layers: "pgwebAcara10:JALAN_LN_25K",
        format: "image/png",
        transparent: true
    }).addTo(map);

    var pointLayer = L.tileLayer.wms("http://localhost:8080/geoserver/pgwebAcara10/wms", {
        layers: "pgwebAcara10:data_kecamatan",
        format: "image/png",
        transparent: true
    }).addTo(map);

    var sampahLayer = L.tileLayer.wms("https://geoportal.slemankab.go.id/geoserver/ows", {
        layers: "geonode:persebaran_titik_persampahan_slemanbce6c1f573f3",
        format: "image/png",
        transparent: true
    });

    var baseMaps = { "OpenStreetMap": osm };

    var overlayMaps = {
        "Polygon Administrasi": polygonLayer,
        "Jalan": jalanLayer,
        "Penduduk (Titik)": pointLayer,
        "Sebaran TPA": sampahLayer
    };

    L.control.layers(baseMaps, overlayMaps).addTo(map);

    // Legend tampil/hilang
    function toggleLegendVisibility() {
        var anyOn = true;
        for (var key in overlayMaps) {
            if (map.hasLayer(overlayMaps[key])) {
                anyOn = true;
                break;
            }
        }
        document.getElementById('bigLegend').style.display = anyOn ? 'block' : 'none';
    }

    toggleLegendVisibility();
    map.on('overlayadd overlayremove', toggleLegendVisibility);
</script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

</body>
</html>
